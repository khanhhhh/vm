#include"thread.h"
#include<stdio.h>
#include<string.h>
#include<stdint.h>
#include<stdlib.h>
thread	thread_new(uint8_t *code, object *data);
int main() {
	char str[14] = "hello world!\n";
	uint32_t len = 14;


	uint32_t *data = malloc(len * sizeof(uint32_t));
	for (uint32_t i=0; i<len; i++) {
		data[i] = (uint32_t) str[14-i-1];
	}

	uint8_t code[] = {
		0x00,				// nop
		0x02, 0x00, 0x00, 0x00, 0x00,	// load data at location 0 // little endian
		0x02, 0x01, 0x00, 0x00, 0x00,	// load data at location 1
		0x02, 0x02, 0x00, 0x00, 0x00,	// load data at location 2
		0x02, 0x03, 0x00, 0x00, 0x00,	// load data at location 3
		0x02, 0x04, 0x00, 0x00, 0x00,	// load data at location 4
		0x02, 0x05, 0x00, 0x00, 0x00,	// load data at location 5
		0x02, 0x06, 0x00, 0x00, 0x00,	// load data at location 6
		0x02, 0x07, 0x00, 0x00, 0x00,	// load data at location 7
		0x02, 0x08, 0x00, 0x00, 0x00,	// load data at location 8
		0x02, 0x09, 0x00, 0x00, 0x00,	// load data at location 9
		0x02, 0x0a, 0x00, 0x00, 0x00,	// load data at location 10
		0x02, 0x0b, 0x00, 0x00, 0x00,	// load data at location 11
		0x02, 0x0c, 0x00, 0x00, 0x00,	// load data at location 12
		0x02, 0x0d, 0x00, 0x00, 0x00,	// load data at location 13
		0xfe, // put char
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xfe,
		0xff
	};

	thread t = thread_new(code, data);
	
	thread_loop(&t);

	return 0;
}
